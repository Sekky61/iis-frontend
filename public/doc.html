<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>

<head>
	<meta http-equiv="content-type" content="text/html; charset=" UTF-8" />
	<title>Projekt IIS</title>
	<style type="text/css">
		body {
			padding: 1rem;
		}

		table {
			border-collapse: collapse;
		}

		td,
		th {
			border: 1px solid black;
			padding: 0.3em 0.5em;
			text-align: left;
		}

		dt {
			font-weight: bold;
			margin-top: 0.5em;
		}

		.code-block {
			display: block;
			white-space: pre-wrap;
			tab-size: 1;
			max-width: max-content;
			padding-right: 40px;
			padding-left: 20px;
			border-width: 1px;
			border-color: black;
			border-style: solid;
			border-radius: 15px;
		}

		.code-block-second {
			display: block;
			white-space: pre-wrap;
			tab-size: 1;
			max-width: max-content;
			padding-right: 40px;
			padding-left: 20px;
			border-width: 1px;
			border-color: black;
			border-style: solid;
			border-radius: 15px;
			background-color: rgb(192, 202, 203);
		}

		.method {
			box-shadow: 3px 3px 4px black;
			padding: 4px;
			padding-left: 20px;
			border-width: 3px;
			border-style: solid;
			font-size: 17px;
			border-radius: 25px;
		}

		.method-get {
			border: rgb(255, 127, 80);
			background-color: rgb(255, 99, 71, 0.5);
		}

		.method-post {
			border: rgb(70, 130, 180);
			background-color: rgb(135, 206, 235);
		}

		.method-delete {
			border: red;
			background-color: rgb(180,38,38);
		}

		details:hover {
			background-color: rgb(169, 169, 169);
		}

		details {
			border: 1px solid black;
			border-radius: 25px;
			background-color: rgb(192, 202, 203);
			padding: 0.3em 0.5em;
			text-align: left;
			padding: 12px;
			margin: 20px;
		}

		details>p {
			box-shadow: 3px 3px 4px black;
		}
	</style>
</head>

<body>

	<!-- Zkontrolujte prosím nastavení kódování v hlavičce dokumentu 
     podle použitého editoru -->

	<h1>Aukce: prodej a nákup zboží a majetku prostřednictvím dražby</h1> <!-- Nahradte názvem svého zadání -->

	<dl>
		<dt>Autoři</dt>
		<dd>Michal Majer
			<!-- Nahraďte skutečným jménem a e-mailem autora a popisem činnosti -->
			<a href="mailto:xmajer21@stud.fit.vutbr.cz">xmajer21@stud.fit.vutbr.cz</a> -
			Tvorba frontendu, provázání s backendem, databáze, testování
		</dd>
		<dd>Petr Pouč
			<!-- Nahraďte skutečným jménem a e-mailem autora a popisem činnosti -->
			<a href="mailto:xpoucp01@stud.fit.vutbr.cz">xpoucp01@stud.fit.vutbr.cz</a> -
			Tvorba frontendu, dokumentace, testování
		</dd>
		<dd>Michal Řezník
			<!-- Nahraďte skutečným jménem a e-mailem autora a popisem činnosti -->
			<a href="mailto:xrezni28@stud.fit.vutbr.cz">xrezni28@stud.fit.vutbr.cz</a> -
			Tvorba databáze
		</dd>
		<dt>URL aplikace</dt>
		<dd>URL aplikace (frontendu): <a href="https://xmajer21-iis.netlify.app/">https://xmajer21-iis.netlify.app/</a>
		</dd>
		<dd>URL backendu: <a href="https://xmajer21-iis.herokuapp.com/">https://xmajer21-iis.herokuapp.com/</a></dd>
	</dl>

	<h2>Uživatelé systému pro testování</h2>
	<div style="display: flex; gap: 1rem;">
		<div>
			<h3>Administrátoři</h3>
			<table>
				<tr>
					<th>Login</th>
					<th>Heslo</th>
				</tr>
				<tr>
					<td>admin1</td>
					<td>iisadmin1</td>
				</tr>
				<tr>
					<td>admin2</td>
					<td>iisadmin2</td>
				</tr>
				<tr>
					<td>admin3</td>
					<td>iisadmin3</td>
				</tr>
			</table>
		</div>
		<div>
			<h3>Licitátoři</h3>
			<table>
				<tr>
					<th>Login</th>
					<th>Heslo</th>
				</tr>
				<tr>
					<td>licitator1</td>
					<td>iislicitator1</td>
				</tr>
				<tr>
					<td>licitator2</td>
					<td>iislicitator2</td>
				</tr>
				<tr>
					<td>licitator3</td>
					<td>iislicitator3</td>
				</tr>
			</table>
		</div>
		<div>
			<h3>Uživatelé</h3>
			<table>
				<tr>
					<th>Login</th>
					<th>Heslo</th>
				</tr>
				<tr>
					<td>user1</td>
					<td>iisuser1</td>
				</tr>
				<tr>
					<td>user2</td>
					<td>iisuser2</td>
				</tr>
				<tr>
					<td>user3</td>
					<td>iisuser3</td>
				</tr>
			</table>
		</div>
	</div>

	<p>(Diagram případů užití není nutné vkládat, pokud IS implementuje role a případy užití definované zadáním.)</p>


	<h2>Implementace</h2>

	Informační systém je implementován jako dvě nezávislé aplikace komunikující přes aplikační rozhraní HTTP.

	<h3>Backend</h3>
	<p>
		Backend je implementován pomocí NodeJS frameworku Express.
		Aplikace je navrhnutá jako soubor cest (endpointů) pro získávání a manipulaci dat. <br />
		Autentizace dotazů je prováděna pomocí session cookies - cookie obsahující session ID, veškerá data sezení jsou
		uložena v databázi
	</p>
	<h4>Komunikace:</h4>
	<p>
		Komunikace využívá formátu JSON, jak data POST dotazů, tak odpovědi. Typický tvar odpovědi je
		<code>{success: bool, message: string, data: Optional(Any)}</code>
	</p>
	<h4>Struktura:</h4>
	<code class="code-block-second">
		api/
		├─ admin/
		├─ licit/
		├─ user/
		├─ auction/:id/
		│  ├─ user/
		│  ├─ licit/
		│  ├─ admin/
	</code>
	<p>
		Veřejné endpointy jsou umístěny do kořenů (<code>/api</code>, <code>/api/auction/:id</code>), ostatní podle
		požadovaných práv (Například endpointy v <code>/api/licit</code> jsou přístupné pouze pro licitátory)
	</p>
	<h4>Výčet endpointů:</h4>
	<details>
		<summary>ADMIN</summary>
		End pointy pro uživatele Admin se nachází: /iis-backend/routes/admin/index.js
		<p class="method method-get">
			<strong>GET</strong> : /api/admin/stats/sessions
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/admin/db-status
		<p class="method method-get">
			<strong>GET</strong> : /api/admin/server-status
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/admin/users
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/admin/change-user-data/ <br /><br /> <i>Metoda jako parametry bere JSON se
				dvěma klíči: id a userdata - kolekce vlastností ke změně</i><br />
			<code class="code-block">
{
	"id": "4",
  		"user_data": {
		"Jmeno": "admin-changed-my-name",
		"Prijmeni": "last-name-too"
	}
}
			</code>
		</p>
		<p class="method method-delete">
			<strong>DELETE</strong> : /api/admin/delete-user/:id
		</p>
	</details>

	<details>
		<summary>LICITÁTOR</summary>
		<p class="method method-get">
			<strong>GET</strong> : /api/licit/my-auctions
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/licit/auctions
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/licit/all-unconfirmed-participants
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/auction/:id/licit/list-participants
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/auction/:id/licit/join
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/auction/:id/licit/evaluate
			<code class="code-block">
{
	winner_id: 4
}
			</code>
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/auction/:id/licit/confirm
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/auction/:id/licit/reject
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/auction/:id/licit/start
		</p>
	</details>

	<details>
		<summary>UŽIVATEL</summary>
		<p class="method method-get">
			<strong>GET</strong> : /api/auction/:id/user/can-join
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/user/auctions-member
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/user/my-objects
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/user/my-auctions
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/auction/:id/user/upload-photo<br></br>
			<i>soubor, multipart/form-data</i>	
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/user/auction<br></br>
			<code class="code-block">
{
	"nazev": "Chata za mestem",
	"vyvolavaci_cena": 150000,
	"min_prihoz": 5000,
	"object": 4,
	"pravidlo": "otevrena",
	"typ": "nabidkova",
	"tagy": ["Zahrada", "2 pokoje", "Studna"],
	"objekt": {
		"nazev": "Chata",
		"adresa": "--",
		"popis": "Chata se studnou blízko řeky",
		"foto_url": null
	}
}
			</code>
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/user/can-join-auctions <br></br>
			<code class="code-block">
{
auctions: [1, 2, 3, 4, 5, 6, 2000]
}
			</code>
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/user/change-user-data <br></br><i>Metoda jako parametry bere staré heslo a JSON se
				dvěma klíči: uživatelské jméno a typ účtu</i><br />
			<code class="code-block">
{
"password": "oldpasswordtoconfirm",
	"user_data": {
		"Jmeno": "Marek",
		"Typ": "licitator"
	}
}
			</code>
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/user/object <br></br>
			<code class="code-block">
"objekt": {
	nazev: 'Chata za mestem'
	adresa: 'Kraví 19, Ostrava',
	popis: 'popis nemovitosti',
	foto_url: null
}
			</code>
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/auction/:id/user/bid <br></br><i>Metoda jako parametr bere JSON - výši
				nabídky</i><br />
			<code class="code-block">
{
	"bid": 80050
}
					</code>
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/auction/:id/user/upload-photo
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/auction/:id/user/join
		</p>
		<p class="method method-delete">
			<strong>DELETE</strong> : /api/auction/:id/user/leave
		</p>
	</details>

	<details>
		<summary>VEŘEJNÉ</summary>
		<p class="method method-get">
			<strong>GET</strong> : /api/auction/:id
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/auction/:id/photo
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/ending-auctions?number=3
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/auctions <br></br><i>Tato funkce bere dva GET parametry: offset, number (to
				značí, kolik aukcí se má načíst od zvoleného offsetu)<br></br>
				<code class="code-block">/api/auctions?offset=0&number=20</code>
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/auction/:id/bids
		</p>
		<p class="method method-get">
			<strong>GET</strong> : /api/get-session-info
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/login
			<code class="code-block">
{
	"username": "admin1",
	"password": "iisadmin1"
}
		</code>
		</p>
		<p class="method method-post">
			<strong>POST</strong> : /api/register
			<code class="code-block">
{
	"first_name": "Jan",
	"last_name": "Novák",
	"username": "novakjede123",
	"password": "1j2a3nJEBOREC",
	"email": "j.novak@gmail.com"
}
		</code>
		</p>

		<p class="method method-post">
			<strong>POST</strong> : /api/logout
		</p>
	</details>



	<h3>Databáze</h3>

	<p>ER diagram reprezentující strukturu naší databáze
		<img src="resources/er.jpg" alt="ER diagram" style="display: block;" />
	</p>

	<h2>Instalace</h2>

	<h3>postup instalace na server</h3>

	Frontend na Netlify i Backend na Heroku se automaticky kopíruje a přeloží z odpovídajících Github repozitářů.

	<h4>frontend:</h4>
	<code class="code-block-second">
		npm install
		npm run build
	</code>

	<h4>backend:</h4>
	Nastavení proměnných prostředí (přímo v prostředí nebo .env souborem) :
	<code>PG_CONN_STRING</code> a
	<code>SESSION_SECRET</code>
	<code class="code-block-second">
		npm install
		node server.js
	</code>

	<h3>softwarové požadavky</h3>
	Frontend
	<ul>
		<li>NPM (při vývoji použita verze 7.20.3)</li>
	</ul>

	Backend
	<ul>
		<li>NodeJS (při vývoji použita verze 16.6.1)</li>
		<li>NPM (při vývoji použita verze 7.20.3)</li>
		<li>PostgreSQL verze 12.9</li>
	</ul>

	<h3>Konfigurace, inicializace</h3>

	<ol>
		<li>Nastavení proměnné prostředí <code>PG_CONN_STRING</code> (connection string pro PostgreSQL)</li>
		<li>Nastavení proměnné prostředí <code>SESSION_SECRET</code> (řetězec pro šifrování cookies)</li>
	</ol>

	Databáze se inicializuje dvěma kroky
	<ol>
		<li>Založení tabulek definovaných v <code>util/schema.sql</code> (vykonat
			např. pomocí <code>psql</code>)</li>
		<li>Naplnění databáze testovacími daty skriptem <code>util/db_seed.js</code>
			(spustitelný příkazem <code>node util/db_seed.js</code>). Alternativně SQL skript util/db_seed.sql</li>
	</ol>

	<h2>Známé problémy</h2>
	<p>Zde popište, které body zadání nejsou implementovány a z jakého důvodu. Např. &bdquo;Z časových důvodů nebyla
		implementována správa uživatelů.&rdquo; Pomůžete tím zrychlit hodnocení, když neimplementované funkce nebudeme
		muset dlouze hledat.</p>

	<h3>Není řešeno</h3>
	<ol>
		<li>Odebrání licitátorských práv uživateli, který spravuje některé aukce</li>
		<li></li>
	</ol>
	<p></p>
	<h2>Poznámky</h2>
	<h3>Délka aukce</h3>
	<p>Doba trvání aukce je vždy nastavena na 7 dní. Pro projekt jsme délku změnili na 30 dní, aby v době opravování projektu stále existovaly probíhající aukce.</p>

</body>

</html>